/* This is a simple query to find the top 10 locations (cities) in terms of orders placed on any specific date */

/* selecting the shipping address city as the location of the sale, and counting how many shopify customers placed an order from that city.
This is one way to quantify orders placed, but does not take into account the amount of the purchase */

SELECT sa.city, count(o.shopifymodel_ptr_id) as values

FROM datasources_shopifyshippingaddress sa
JOIN datasources_shopifyorder o ON sa.order_id = o.shopifymodel_ptr_id

AND o.created_at = timestamp '2099-01-01' at time zone 'America/Los_Angeles' at time zone 'UTC'

GROUP BY sa.city ORDER BY values DESC limit 10;

/* by ordering it by our 'orders placed' (values) in descending order and limiting it to 10, we get the "Top 10" */
